<template class="task-template" id="panel-databases">
<div id="panel-databases">

  <div class="form-group">
    <h6 for="select-species">Select Species</h6>
    <div class="input-group col-sm-6">
      <select id="species" class="selectpicker form-control" multiple data-style="btn-selectpicker" data-actions-box="true" title="Choose one or more of the following...">
      </select>    
    </div>
  </div>  

  <div class="form-group">
    <h6 for="select-dbfile">Select the prefix label of decoy proteins</h6>
    <div class="form-group row col-sm-6">
      <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text labeldecoy">Decoy label</span>
        </div>
        <input type="text" class="form-control" placeholder="Write Decoy label of your protein database" aria-describedby="labeldecoy" id="labeldecoy">
      </div>  
    </div>
  </div>

  <div class="form-group">
    <h6 for="select-catids">Select the UniProt version of category database</h6>
    <div class="input-group col-sm">
      <select class="custom-select" id="catids"></select>
    </div>
  </div>

  <div class="form-group">
    <h6 for="select-catids">Show/Hide relationship tables</h6>
    <input class="toggleadv" type="checkbox" data-toggle="toggle" data-on="Show" data-off="Hide" data-onstyle="light" data-offstyle="dark" data-width="50px" data-height="30px" data-size="sm" onchange="toggleTaskTable(this)" checked>
  </div>

</div>
<script>

// Add values into panel, if apply
function addValuesDatabasesPanel() {
  // Imported variables
  let remote = require('electron').remote;
  let mainWindow = remote.getCurrentWindow();
  let dialog = remote.dialog;
  let exceptor = require(`${__dirname}/renderer-process/exceptor`);
  let importer = require(`${__dirname}/renderer-process/imports`);
  let wf_exec  = importer.wf_exec;
  let wk_id = 'databases';
  let cmd_id = 'RELS_TABLE';
  
  // check
  if ( wf_exec === undefined ) {
    let errsms = `wf_exec is undefined`;
    console.log(`${errsms}`);
    exceptor.showErrorMessageBox('Error Message', `${errsms}`);
  }
  if (!(wk_id in wf_exec)) {
    let errsms = `'${wk_id}' key is not in wf_exec`;
    console.log(`${errsms}`);
    exceptor.showErrorMessageBox('Error Message', `${errsms}`);
  }

  // Init html objects
  // with species
  for (var i = 0; i < wf['species'].length; i++) {
    let wf_species = wf['species'][i];
    $(`#${wk_id} #page-tasktable-${cmd_id} #species`).append(`<option selected value="${wf_species['scientific']}">${wf_species['name']}</option>`);
  }
  // with database version of categories
  for (var i = 0; i < wf['catids'].length; i++) {
    let wf_catids = wf['catids'][i];
    $(`#${wk_id} #page-tasktable-${cmd_id} #catids`).append(`<option value="${wf_catids['id']}" >${wf_catids['name']}</option>`);
  }

  // Add values
  let species = wf_exec['databases']['species'].split(',');
  $(`#${wk_id} #page-tasktable-${cmd_id} #species`).selectpicker('val', species);
  $(`#${wk_id} #page-tasktable-${cmd_id} #labeldecoy`).val(`${wf_exec['databases']['labeldecoy']}`);
  $(`#${wk_id} #page-tasktable-${cmd_id} #catids`).val(`${wf_exec['databases']['catid']}`); // Category DATABASE
  
  // Hide table
  $(`#${wk_id} #page-tasktable-${cmd_id} .tasktable`).hide();

} // end addValuesDatabasesPanel


// Create object with the Databases data extracting from the HTML Elements
function createObjFromDatabasesPanel() {
  let rst = {
    'species': '',
    'labeldecoy': '',
    'catid': '',
    'catdbs': ''
  };
  // extract db name and save
  let db = $(`#panel-databases [id='catids'] option:selected`).val();
  rst['catid'] = db;
  // look throught species list
  let species = $(`#panel-databases [id='species'] option:selected`);
  for (var i = 0; i < species.length; i++) {
    let o = species[i];
    let v1 = $(o).val();
    let v2 = $(o).text().toLowerCase();
    // update species data
    if (rst['species'] != '') { rst['species'] += `,${v1}` } else { rst['species'] += v1 }
    // update category database
    let v = `${process.env.ISANXOT_LIB_HOME}/dbs/${db}/${v2}_${db}_sw-tr.categories.tsv`;
    if (rst['catdbs'] != '') { rst['catdbs'] += `;${v}` } else { rst['catdbs'] += v }
  }
  // update decoy label
  let dlabel = $(`#panel-databases [id='labeldecoy']`).val();
  rst['labeldecoy'] = dlabel;
  return rst;
} // end createObjFromDatabasesPanel

// Show/Hide table
function toggleTaskTable(t) {
  let wk_id = 'databases';
  let cmd_id = 'RELS_TABLE';

  if ( $(t).prop('checked') ) {
    $(`#${wk_id} #page-tasktable-${cmd_id} .tasktable`).hide();
  }
  else {
    $(`#${wk_id} #page-tasktable-${cmd_id} .tasktable`).show();
    $(`#${wk_id} #page-tasktable-${cmd_id} .tasktable`).handsontable('render');
  }
}

</script>
</template>